# 1 基本介绍

* 主要分为功能权限和数据权限
* 功能权限：如页面是否可见，按钮是否可用，用户可以看到哪些选项等
* 数据权限：用户在使用某个功能权限时（例如查询所有项目），对可以得到的数据的范围的控制

## 1.1 设计方法
* 功能权限主要使用rbac模型，即 用户-角色-功能点，功能点就是具体的功能权限，如“添加项目”，“编辑流水线”等，是原子性的操作，可以为角色分配多个功能点，
该角色就可以执行这些功能点，再为用户分配一至多个角色，用户就可以通过角色使用这些功能点。具体方法是 分别建立 用户-角色关联表和 角色-功能点关联表，来
实现这种多对多的关系。

## 1.2 主要表介绍

只介绍重要的字段和大体结构

* 功能点表

| 字段名   |      含义         |
|:--------:|:---------------:|
| id      |         id       |
| description  | 对功能点的具体描述 |
| is_private    | 表示是否私有，之后可能会有继承功能，暂时没用到 |
| parent_id|  父功能点ID，之后可能会有继承功能，暂时没用到 |

* 角色表

| 字段名   |      含义         |
|:--------:|:---------------:|
| id      |      id         |
| parent_id|  父角色ID，之后可能会有继承功能，暂时没用到 |

* 用户表（不在权限模块下）

仅需要用户的 ID、 名称

* 角色-功能点关联表

| 字段名   |      含义         |
|:--------:|:---------------:|
| id      |         id       |
| permission_id  | 功能点ID |
| role_id    | 角色ID  |

* 用户-角色关联表

| 字段名   |      含义         |
|:--------:|:---------------:|
| id      |         id       |
| user_id  | 用户ID |
| role_id    | 角色ID  |

* 用户数据规则表

| 字段名   |      含义         |
|:--------:|:---------------:|
| id      |         id       |
| role_id    | 角色ID，说明此规则应用在哪个角色上  |
| rule    | 具体规则，例如"in", "equals"等  |
| field_name    | 规则作用的参数名称   |
| description   | 对规则的具体解释 |

* 用户可操作数据表

| 字段名   |      含义         |
|:--------:|:---------------:|
| id      |         id       |
| user_id    | 用户ID，说明这条数据可以被哪个用户操作  |
| rule_id    | 规则id  |
| field_value   | 规则作用的参数的值，通过这个值过滤出可被操作的数据 |
| description   | 对规则的具体解释 |

# 2 权限用法 

以角色模块为例，在角色管理中有实现代码。
## 2.1 后端开发API时，使用权限服务控制功能点

### 2.1.1 创建功能点
在网页上（dop平台）进入权限管理-功能点管理-点击创建功能点，
### 2.1.2 API controller层的参数中加入 userId
在你需要控制权限的API controller层中的函数参数中加入userId，让后端可以验证用户是否具有此权限

